{% extends "base.html" %}
{% block title %}Timeline Extraction{% endblock %}

{% block content %}
<button id="mobile-menu-toggle" class="btn btn-sm btn-primary d-md-none mb-3">
  <i data-feather="menu"></i>
  <span>Menu</span>
</button>

<div class="header">
  <h1 class="header-title">Timeline Extraction</h1>
  <p class="header-subtitle">
    Upload patient records to extract timelines and treatment responses.
  </p>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div class="btn-group" role="group" aria-label="Navigation Buttons">
    <a href="{{ url_for('api.timeline') }}" 
       class="btn btn-outline-secondary {% if request.endpoint == 'api.timeline' %}active{% endif %}">
       Timeline Extraction
    </a>
    <a href="{{ url_for('api.timeline_evaluation') }}" 
       class="btn btn-outline-secondary {% if request.endpoint == 'api.timeline_evaluation' %}active{% endif %}">
       Timeline Evaluation
    </a>
  </div>

  <a href="#" id="download-results" class="btn btn-primary btn-sm">
    <i class="fa fa-download"></i> ⬇️Download Results
  </a>
</div>

<div id="alert-container"></div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="card-header-title mb-0">Patient Data</h5>
    <div class="btn-group" role="group">
      <!-- Timeline supports only file upload -->
    </div>
  </div>

  <div class="card-body">
    <!-- File upload section -->
    <div id="file-input-section">
      <div id="dropzone" class="dropzone">
        <div class="dropzone-icon">
          <i data-feather="file-text" width="48" height="48"></i>
        </div>
        <h5 class="dropzone-message">Drag & drop your file here</h5>
        <p class="dropzone-description">or click to browse files</p>
        <input id="file-input" type="file" class="d-none" accept=".xlsx" multiple />
      </div>
    </div>

    <!-- Control buttons -->
    <div class="text-right mt-3">
      <button id="clear-button" class="btn btn-secondary mr-2">Clear</button>
      <button id="process-button" class="btn btn-primary">Processa</button>
    </div>
  </div>
</div>

<!-- Loading spinner -->
<div id="loading-spinner" class="spinner-container d-none">
  <div class="spinner-border text-primary" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <p class="mt-2">Elaborazione timeline...</p>
</div>

<!-- Results section -->
<div id="results-section" class="d-none mt-4">
  <div class="card">
    <div class="card-header">
      <h5 class="card-header-title">Results</h5>
      <small class="text-muted d-block mt-1">
        Le TC mostrano un badge <strong>RECIST</strong> (CR/PR/SD/PD/NE). L’export include anche le colonne
        <code>risposta_recist</code>, <code>basis_compared_to</code>, <code>basis_note</code>.
      </small>
    </div>
    <div class="card-body p-3">
      <div id="features-container" class="features-container"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- SheetJS for Excel parsing/export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- Page logic -->
<script src="{{ url_for('static', filename='js/timeline.js') }}"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    feather.replace();
  });
</script>
{% endblock %}
